{{>layout/header}}

<div id="carouselExampleIndicators" class="carousel slide mb-5" data-bs-ride="carousel">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=1200&auto=format&fit=crop" class="d-block w-100" alt="..." style="height: 400px; object-fit: cover; filter: brightness(0.7);">
            <div class="carousel-caption d-none d-md-block">
                <h2 class="fw-bold display-5">2025 NEW SEASON</h2>
                <p class="fs-5">당신의 일상을 특별하게 만드는 스타일</p>
                <a href="#new-arrivals" class="btn btn-light fw-bold px-4 py-2 mt-3">SHOP NOW</a>
            </div>
        </div>
        <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=1200&auto=format&fit=crop" class="d-block w-100" alt="..." style="height: 400px; object-fit: cover; filter: brightness(0.7);">
            <div class="carousel-caption d-none d-md-block">
                <h2 class="fw-bold display-5">BEST COLLECTION</h2>
                <p class="fs-5">가장 사랑받는 아이템을 만나보세요</p>
            </div>
        </div>
        <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?q=80&w=1200&auto=format&fit=crop" class="d-block w-100" alt="..." style="height: 400px; object-fit: cover; filter: brightness(0.7);">
            <div class="carousel-caption d-none d-md-block">
                <h2 class="fw-bold display-5">SPECIAL SALE</h2>
                <p class="fs-5">놓칠 수 없는 특별한 혜택</p>
            </div>
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<div class="container" id="new-arrivals">
    <h3 class="fw-bold mb-4">New Arrivals</h3>

    <style>
        /* 카드 호버 효과 */
        .item-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border: none;
        }
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }

        /* 찜 버튼 (하트) 스타일 */
        .wish-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .wish-btn:hover {
            background: #fff;
            transform: scale(1.1);
        }

        /* [위치 수정됨] 하트랑 겹치지 않게 top: 55px로 설정 */
        .event-badge {
            position: absolute;
            top: 55px;
            left: 10px;
            background-color: #9b59b6; /* 보라색 */
            color: white;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 800;
            border-radius: 20px;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .discount-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: #e74c3c;
            color: white;
            padding: 3px 8px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 4px;
        }
    </style>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mb-5">
        {{#items}}
            <div class="col">
                <div class="card h-100 item-card shadow-sm position-relative">

                    <a href="/item/{{id}}" class="text-decoration-none text-dark">
                        <div style="position: relative; overflow: hidden; border-radius: 6px 6px 0 0;">
                            <img src="{{imgUrl}}" class="card-img-top" alt="{{name}}" style="height: 250px; object-fit: cover;">

                            {{#isEvent}}
                                <div class="discount-badge">{{discountRate}}%</div>
                            {{/isEvent}}
                        </div>
                    </a>

                    <button class="wish-btn text-danger" onclick="toggleWish({{id}})">
                        <i class="far fa-heart" id="heart-{{id}}"></i>
                    </button>

                    {{#isEvent}}
                        <div class="event-badge">EVENT</div>
                    {{/isEvent}}

                    <div class="card-body p-3">
                        <div class="text-muted small mb-1">{{brand}}</div>
                        <h5 class="card-title fs-6 fw-bold text-truncate">{{name}}</h5>
                        <div class="d-flex align-items-center mt-2">
                            {{#isEvent}}
                                <span class="text-decoration-line-through text-muted small me-2">{{price}}</span>
                                <span class="fw-bold text-danger fs-5">{{salePrice}}원</span>
                            {{/isEvent}}

                            {{^isEvent}}
                                <span class="fw-bold fs-5">{{price}}원</span>
                            {{/isEvent}}
                        </div>
                    </div>
                </div>
            </div>
        {{/items}}
    </div>
</div>

<script>
    function toggleWish(itemId) {
        fetch('/wish/' + itemId, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
            if (response.status === 401) {
                // 로그인이 안 된 경우에만 알림을 띄우고 이동합니다.
                if(confirm('로그인이 필요한 서비스입니다. 로그인 페이지로 이동하시겠습니까?')) {
                     location.href = '/login';
                }
                return;
            }
            if (response.ok) {
                const heart = document.getElementById('heart-' + itemId);
                // 알림(alert) 없이 아이콘 모양만 바꿉니다.
                if (heart.classList.contains('far')) {
                    heart.classList.replace('far', 'fas'); // 빈 하트 -> 채워진 하트
                } else {
                    heart.classList.replace('fas', 'far'); // 채워진 하트 -> 빈 하트
                }
            }
        });
    }
</script>

{{>layout/footer}}